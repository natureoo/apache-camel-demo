<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:camel="http://camel.apache.org/schema/spring"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
        http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring-2.14.1.xsd ">
    <camelContext  xmlns="http://camel.apache.org/schema/spring">
        <endpoint id="jetty_from" uri="jetty:http://0.0.0.0:8282/httpCamel"/>
        <endpoint id="log_to1" uri="jetty:http://localhost:8081/camel/post"/>
        <endpoint id="log_to2" uri="jetty:http://localhost:8082/camel/post"/>
        <!--<route errorHandlerRef="myErrorHandler">-->
        <route >

            <from ref="jetty_from"/>
            <process ref="httpProcesser"></process>
            <setHeader headerName="CamelHttpMethod">
                <simple>POST</simple>
            </setHeader>
            <setHeader headerName="Content-Type">
                <simple>application/json</simple>
            </setHeader>

            <onException>
                <exception>java.io.IOException</exception>
                <continued><constant>true</constant></continued>

            </onException>
                <loadBalance>
                    <custom ref="myBalancer"></custom>
                    <to ref="log_to1"/> <to ref="log_to2"/>
                </loadBalance>
            <to uri="log:directRouteA?showExchangeId=true"></to>
            <to  uri="direct:directRouteB"></to>
            <!--<process ref="otherProcesser"></process>-->
        </route>
        <route>
            <from uri="direct:directRouteB"></from>
            <process ref="otherProcesser"></process>
            <to uri="log:directRouteB?showExchangeId=true"></to>
        </route>

    </camelContext>

    <bean id='myBalancer' class='demo.chenj.failover.CustomLoadBalance' />

    <bean id="httpProcesser" class="demo.chenj.processer.HttpProcessor"></bean>
    <bean id="otherProcesser" class="demo.chenj.processer.OtherProcessor"></bean>
    <bean id="exceptionProcesser" class="demo.chenj.processer.ExceptionProcessor"></bean>
</beans>